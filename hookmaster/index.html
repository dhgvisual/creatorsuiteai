<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HookMaster AI (Multi-Provider)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { slate: { 850: '#151f32', 950: '#020617' } }, fontFamily: { sans: ['Inter', 'sans-serif'] } } } }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .emoji-icon { display: inline-block; transform: translateY(-1px); margin-right: 6px; filter: grayscale(100%); opacity: 0.7; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .faq-content { transition: max-height 0.3s ease-out, opacity 0.3s ease-out; max-height: 0; opacity: 0; overflow: hidden; }
        .faq-content.open { max-height: 500px; opacity: 1; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 font-sans antialiased transition-colors duration-200">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const Icon = ({ c }) => <span className="emoji-icon">{c}</span>;

        function App() {
            // State
            const [activeTab, setActiveTab] = useState('generator');
            
            // --- SETTINGS STATE (Provider, Key, Model) ---
            const [provider, setProvider] = useState(() => localStorage.getItem('hm_provider') || 'gemini');
            const [apiKey, setApiKey] = useState(() => localStorage.getItem('hm_api_key') || '');
            const [aiModel, setAiModel] = useState(() => localStorage.getItem('hm_ai_model') || 'gemini-1.5-flash');
            const [isSettingsOpen, setIsSettingsOpen] = useState(!localStorage.getItem('hm_api_key'));
            
            // Data State
            const [formData, setFormData] = useState({ topic: '', audience: '', pain: '', goal: '', keyword: '', platform: 'TikTok / Reels', vibe: 'Santai', language: 'Indonesia' });
            const [generatedHooks, setGeneratedHooks] = useState([]);
            const [isGenerating, setIsGenerating] = useState(false);
            const [savedHooks, setSavedHooks] = useState(() => JSON.parse(localStorage.getItem('saved_hooks') || '[]'));
            const [savedPersonas, setSavedPersonas] = useState(() => JSON.parse(localStorage.getItem('saved_personas') || '[]'));
            
            // UI
            const [imageFile, setImageFile] = useState(null);
            const [imagePreview, setImagePreview] = useState(null);
            const [showPersonaMenu, setShowPersonaMenu] = useState(false);
            const [errorMsg, setErrorMsg] = useState(null);
            const fileInputRef = useRef(null);

            // Modals
            const [contentModal, setContentModal] = useState({ isOpen: false, isLoading: false, text: '', data: null, type: '', hookUsed: '' });
            const [analysisModal, setAnalysisModal] = useState({ isOpen: false, isLoading: false, data: null, hookUsed: '' });
            const [visualModal, setVisualModal] = useState({ isOpen: false, isLoading: false, data: null, hookUsed: '' });
            const [repurposeModal, setRepurposeModal] = useState({ isOpen: false, isLoading: false, data: null, hookUsed: '' });
            const [personaModal, setPersonaModal] = useState({ isOpen: false, isEditing: false, data: null });
            const [quickSaveModal, setQuickSaveModal] = useState(false);

            // Constants
            const contentTypes = ['Edukasi', 'Komedi/Hiburan', 'Promosi/Jualan', 'Inspirasi', 'Tips & Trik', 'Storytelling', 'Behind The Scene', 'Q&A', 'Trending', 'Review', 'Mitos vs Fakta', 'Life Hack', 'Tutorial', 'Testimoni', 'Challenge', 'Kontroversi', 'Data Unik', 'A Day in My Life'];
            const faqData = [
                { q: "Apa itu HookMaster AI?", a: "Asisten konten all-in-one untuk membuat hook viral, naskah, dan strategi konten." },
                { q: "Cara ganti Provider AI?", a: "Klik tombol Settings (‚öôÔ∏è). Pilih provider (Gemini, Groq, atau DeepSeek). Masukkan API Key dari provider tersebut." },
                { q: "Groq itu apa?", a: "Provider AI yang sangat cepat dan menyediakan model Llama 3 secara gratis (saat ini). Pilihan terbaik jika Gemini kena limit." }
            ];
            const [openFaqIndex, setOpenFaqIndex] = useState(null);

            // Search States
            const [searchSaved, setSearchSaved] = useState('');
            const [searchPersonas, setSearchPersonas] = useState('');
            const [searchCalendar, setSearchCalendar] = useState('');
            const [searchFAQ, setSearchFAQ] = useState('');
            const [ideaInput, setIdeaInput] = useState('');
            const [ideaType, setIdeaType] = useState('Edukasi');
            const [generatedIdeas, setGeneratedIdeas] = useState([]);
            const [isGeneratingIdeas, setIsGeneratingIdeas] = useState(false);

            useEffect(() => {
                localStorage.setItem('hookmaster_theme', darkMode ? 'dark' : 'light');
                if (darkMode) document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark');
            }, [darkMode]);
            useEffect(() => { localStorage.setItem('saved_hooks', JSON.stringify(savedHooks)); }, [savedHooks]);
            useEffect(() => { localStorage.setItem('saved_personas', JSON.stringify(savedPersonas)); }, [savedPersonas]);

            // --- FILTER LOGIC ---
            const filteredSavedHooks = savedHooks.filter(h => h.text.toLowerCase().includes(searchSaved.toLowerCase()) || h.category.toLowerCase().includes(searchSaved.toLowerCase()));
            const filteredPersonas = savedPersonas.filter(p => p.name.toLowerCase().includes(searchPersonas.toLowerCase()) || p.topic.toLowerCase().includes(searchPersonas.toLowerCase()));
            const filteredCalendar = savedHooks.filter(h => h.scheduledDate).filter(h => h.text.toLowerCase().includes(searchCalendar.toLowerCase()));
            const filteredFAQ = faqData.filter(item => item.q.toLowerCase().includes(searchFAQ.toLowerCase()) || item.a.toLowerCase().includes(searchFAQ.toLowerCase()));

            // --- API LOGIC (MULTI-PROVIDER) ---
            const parseAIResponse = (text) => {
                if (!text) return null;
                try {
                    let clean = text.replace(/```json/g, '').replace(/```/g, '').trim();
                    const firstHook = clean.indexOf('['); const lastHook = clean.lastIndexOf(']');
                    if(firstHook >= 0 && lastHook >= 0) return JSON.parse(clean.substring(firstHook, lastHook+1));
                    const firstCurly = clean.indexOf('{'); const lastCurly = clean.lastIndexOf('}');
                    if(firstCurly >= 0 && lastCurly >= 0) return JSON.parse(clean.substring(firstCurly, lastCurly+1));
                    return JSON.parse(clean);
                } catch (e) { console.error("Parse Error", e); return null; }
            };

            const callAI = async (prompt, isJson = true) => {
                if (!apiKey) { alert("Masukkan API Key di Settings!"); setIsSettingsOpen(true); throw new Error("No Key"); }
                
                let endpoint, body, headers;
                
                // KONFIGURASI PROVIDER
                if (provider === 'gemini') {
                    endpoint = `https://generativelanguage.googleapis.com/v1beta/models/${aiModel}:generateContent?key=${apiKey}`;
                    headers = { 'Content-Type': 'application/json' };
                    
                    let parts = [{ text: prompt }];
                    // Gemini Image Support
                    if (imageFile && !aiModel.includes('gemma')) {
                        parts.push({ inlineData: { mimeType: imageFile.mimeType, data: imageFile.data } });
                    }

                    body = JSON.stringify({ 
                        contents: [{ parts: parts }],
                        safetySettings: [
                            { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                        ]
                    });

                } else if (provider === 'groq' || provider === 'deepseek') {
                    // Standard OpenAI Format (Groq / DeepSeek / OpenRouter)
                    endpoint = provider === 'groq' 
                        ? 'https://api.groq.com/openai/v1/chat/completions' 
                        : 'https://api.deepseek.com/v1/chat/completions'; // Adjust if using OpenRouter
                    
                    headers = { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    };

                    // Note: Groq/DeepSeek models are mostly Text-Only via this endpoint for now
                    if (imageFile) console.warn("Gambar diabaikan untuk provider ini (Text Only).");

                    body = JSON.stringify({
                        model: aiModel,
                        messages: [
                            { role: "system", content: "You are a helpful creative assistant. Always output valid JSON when requested." },
                            { role: "user", content: prompt }
                        ],
                        temperature: 0.7
                    });
                }

                try {
                    const response = await fetch(endpoint, { method: 'POST', headers, body });
                    const data = await response.json();

                    if (data.error) throw new Error(data.error.message || JSON.stringify(data.error));

                    let rawText = "";
                    if (provider === 'gemini') {
                        rawText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    } else {
                        // OpenAI Format Response
                        rawText = data.choices?.[0]?.message?.content;
                    }

                    if (!rawText) throw new Error("Tidak ada respon teks dari AI.");
                    
                    return isJson ? parseAIResponse(rawText) : rawText;

                } catch (err) {
                    console.error("AI Error:", err);
                    throw err;
                }
            };

            const generateWithAI = async () => {
                setIsGenerating(true); setErrorMsg(null); setGeneratedHooks([]);
                
                // Prompt disesuaikan agar model lain juga mengerti format JSON
                const promptText = `Role: Senior Copywriter. Buat 6 hook ${formData.platform} (${formData.language}, gaya ${formData.vibe}). Topik: ${formData.topic}. Keyword SEO (WAJIB ADA): ${formData.keyword}. Target: ${formData.audience}. Pain: ${formData.pain}. Goal: ${formData.goal}. Output JSON Array ONLY (no markdown): [{"category":"Jenis","tone":"Tone","text":"Hook text","hashtags":["#tag"]}]`;
                
                try {
                    const res = await callAI(promptText, true);
                    if (res && Array.isArray(res)) {
                        setGeneratedHooks(res.map((h, i) => ({...h, id: `ai-${Date.now()}-${i}`, timestamp: Date.now()})));
                    } else { throw new Error("Format respon AI tidak valid."); }
                } catch (err) { 
                    setErrorMsg("Gagal: " + err.message); 
                    alert(`Gagal: ${err.message}\n\nCoba ganti Provider/Model di Settings jika limit habis.`);
                } 
                finally { setIsGenerating(false); }
            };

            // Wrappers for other features
            const analyzeHook = async (hookText) => {
                setAnalysisModal({ isOpen: true, isLoading: true, data: null, hookUsed: hookText });
                try { const res = await callAI(`Analisis hook: "${hookText}". Target: ${formData.audience}. Output JSON: { "score": 85, "reason": "...", "improvement": "..." }`, true); setAnalysisModal(prev => ({ ...prev, isLoading: false, data: res })); } catch (e) { setAnalysisModal(prev => ({ ...prev, isLoading: false })); }
            };
            const generateVisual = async (hookText) => {
                setVisualModal({ isOpen: true, isLoading: true, data: null, hookUsed: hookText });
                try { const res = await callAI(`Ide visual sinematik untuk: "${hookText}". Output JSON: { "scene": "...", "overlay_text": "...", "color_vibe": "..." }`, true); setVisualModal(prev => ({ ...prev, isLoading: false, data: res })); } catch (e) { setVisualModal(prev => ({ ...prev, isLoading: false })); }
            };
            const generateContent = async (hookText, isCarousel = false) => {
                const type = isCarousel ? 'Carousel Slide' : 'Naskah Konten';
                setContentModal({ isOpen: true, isLoading: true, text: '', data: null, type, hookUsed: hookText });
                const prompt = isCarousel ? `Buat 5 slide carousel: "${hookText}". JSON Array: [{"section":"Slide 1","visual":"...","content":"..."}]` : `Buat naskah lengkap hook: "${hookText}". JSON Array: [{"section":"Intro","visual":"...","content":"..."}]`;
                try {
                    const res = await callAI(prompt, true);
                    if (res) {
                        const plainText = res.map(row => `${row.section}\n[Visual: ${row.visual}]\n${row.content}`).join('\n\n');
                        setContentModal(prev => ({ ...prev, isLoading: false, data: res, text: plainText }));
                    }
                } catch (e) { setContentModal(prev => ({ ...prev, isLoading: false, text: "Gagal konten.", data: null })); }
            };
            const repurposeContent = async (hookText) => {
                setRepurposeModal({ isOpen: true, isLoading: true, data: null, hookUsed: hookText });
                try { const res = await callAI(`Repurpose hook "${hookText}" jadi 3 format. JSON: { "tiktok_script": "...", "linkedin_post": "...", "twitter_thread": "..." }`, true); setRepurposeModal(prev => ({ ...prev, isLoading: false, data: res })); } catch (e) { setRepurposeModal(prev => ({ ...prev, isLoading: false })); }
            };
            const generateIdeas = async () => {
                if(!ideaInput) return;
                setIsGeneratingIdeas(true);
                try { const res = await callAI(`5 ide konten "${ideaType}" tentang "${ideaInput}". JSON: [{"topic":"Judul","angle":"Angle"}]`, true); if(res) setGeneratedIdeas(res); } catch(e) {} finally { setIsGeneratingIdeas(false); }
            };

            // Handlers
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onloadend = () => { setImagePreview(reader.result); setImageFile({ mimeType: file.type, data: reader.result.split(',')[1] }); };
                reader.readAsDataURL(file);
            };
            const handleSaveHook = (hook) => {
                if (savedHooks.some(h => h.id === hook.id)) setSavedHooks(prev => prev.filter(h => h.id !== hook.id));
                else setSavedHooks(prev => [{...hook, savedAt: Date.now(), status: 'Ide'}, ...prev]);
            };
            const handleUsePersona = (p) => {
                setFormData({ ...formData, topic: p.topic, audience: p.audience, pain: p.pain, goal: p.goal });
                setShowPersonaMenu(false);
            };
            const handleQuickSavePersona = (e) => {
                e.preventDefault();
                const name = e.target.personaName.value;
                if(!name) return;
                setSavedPersonas([{id: Date.now(), name: name, topic: formData.topic, audience: formData.audience, pain: formData.pain, goal: formData.goal, platform: formData.platform, createdAt: Date.now()}, ...savedPersonas]);
                setQuickSaveModal(false);
            };

            const saveSettings = (e) => {
                e.preventDefault();
                const p = e.target.provider.value;
                const k = e.target.apiKey.value.trim();
                const m = e.target.model.value;
                setProvider(p); setApiKey(k); setAiModel(m);
                localStorage.setItem('hm_provider', p);
                localStorage.setItem('hm_api_key', k);
                localStorage.setItem('hm_ai_model', m);
                setIsSettingsOpen(false);
                alert("Pengaturan tersimpan!");
            };

            // --- RENDER ---
            return (
                <div className={darkMode ? "dark" : ""}>
                    <div className="min-h-screen bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 pb-20 selection:bg-blue-100 dark:selection:bg-blue-900/50">
                        {/* NAVBAR */}
                        <header className="bg-white/90 dark:bg-slate-900/90 backdrop-blur border-b border-slate-200 dark:border-slate-800 sticky top-0 z-30">
                            <div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <img src={darkMode ? "logo W.png" : "logo B.png"} alt="HookMaster" className="h-9 w-auto object-contain transition-all duration-300" />
                                    <h1 className="font-black text-xl tracking-tight text-slate-900 dark:text-white">HookMaster</h1>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => setIsSettingsOpen(true)} className="p-2 bg-slate-100 dark:bg-slate-800 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors border border-slate-200 dark:border-slate-700 flex items-center gap-2 px-4 text-xs font-bold">
                                        <Icon c="‚öôÔ∏è" /> {provider === 'gemini' ? 'Gemini' : provider === 'groq' ? 'Groq' : 'DeepSeek'}
                                    </button>
                                    <button onClick={() => setDarkMode(!darkMode)} className="p-2 bg-slate-100 dark:bg-slate-800 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors"><Icon c={darkMode ? "‚òÄÔ∏è" : "üåô"} /></button>
                                </div>
                            </div>
                            <div className="md:hidden overflow-x-auto border-t border-slate-200 dark:border-slate-800">
                                <div className="flex p-2 gap-2 min-w-max">
                                    {['generator', 'saved', 'personas', 'ideas', 'calendar', 'faq'].map(tab => (
                                        <button key={tab} onClick={() => setActiveTab(tab)} className={`px-3 py-2 rounded-lg text-xs font-bold capitalize whitespace-nowrap ${activeTab === tab ? 'bg-blue-600 text-white' : 'bg-white dark:bg-slate-800 border dark:border-slate-700'}`}>{tab}</button>
                                    ))}
                                </div>
                            </div>
                        </header>

                        {/* --- SETTINGS MODAL --- */}
                        {isSettingsOpen && (
                            <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in">
                                <div className="bg-white dark:bg-slate-900 w-full max-w-md p-6 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-800">
                                    <h3 className="font-bold text-lg mb-4 flex items-center gap-2"><Icon c="‚öôÔ∏è"/> Pengaturan AI</h3>
                                    <form onSubmit={saveSettings} className="space-y-4">
                                        <div>
                                            <label className="block text-xs font-bold uppercase text-slate-400 mb-1">Pilih Provider</label>
                                            <select name="provider" defaultValue={provider} onChange={(e) => setProvider(e.target.value)} className="w-full p-3 border rounded-xl bg-slate-50 dark:bg-slate-800 text-sm font-bold dark:border-slate-700">
                                                <option value="gemini">Google Gemini (Gratis / Limit Harian)</option>
                                                <option value="groq">Groq (Gratis / Super Cepat)</option>
                                                <option value="deepseek">DeepSeek (Murah)</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-xs font-bold uppercase text-slate-400 mb-1">Model AI</label>
                                            {provider === 'gemini' ? (
                                                <select name="model" defaultValue={aiModel.includes('gemini') ? aiModel : 'gemini-1.5-flash'} className="w-full p-3 border rounded-xl bg-slate-50 dark:bg-slate-800 text-sm">
                                                    <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite (Rekomendasi - Limit Aman)</option>
                                                    <option value="gemini-1.5-flash">Gemini 1.5 Flash (Stabil)</option>
                                                    <option value="gemini-3-flash">Gemini 3.0 Flash (Experimental)</option>
                                                </select>
                                            ) : provider === 'groq' ? (
                                                <select name="model" defaultValue={aiModel.includes('llama') ? aiModel : 'llama3-70b-8192'} className="w-full p-3 border rounded-xl bg-slate-50 dark:bg-slate-800 text-sm">
                                                    <option value="llama3-70b-8192">Llama 3 70B (Recommended)</option>
                                                    <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                                                    <option value="gemma2-9b-it">Gemma 2 9B</option>
                                                </select>
                                            ) : (
                                                <input name="model" defaultValue="deepseek-chat" className="w-full p-3 border rounded-xl bg-slate-50 dark:bg-slate-800 text-sm" />
                                            )}
                                        </div>

                                        <div>
                                            <label className="block text-xs font-bold uppercase text-slate-400 mb-1">API Key</label>
                                            <input name="apiKey" defaultValue={apiKey} placeholder="Paste API Key disini..." className="w-full p-3 border rounded-xl bg-slate-50 dark:bg-slate-800 text-sm font-mono dark:border-slate-700" required />
                                            <div className="mt-1 text-[10px] text-blue-500 hover:underline">
                                                {provider === 'gemini' ? <a href="https://aistudio.google.com/app/apikey" target="_blank">Dapatkan Google AI Key üîó</a> : 
                                                 provider === 'groq' ? <a href="https://console.groq.com/keys" target="_blank">Dapatkan Groq API Key üîó</a> : 
                                                 <a href="https://platform.deepseek.com/api_keys" target="_blank">Dapatkan DeepSeek Key üîó</a>}
                                            </div>
                                        </div>

                                        <div className="flex gap-2 pt-2">
                                            <button type="button" onClick={() => setIsSettingsOpen(false)} className="flex-1 py-2 text-center border rounded-xl text-xs font-bold hover:bg-slate-50 dark:hover:bg-slate-800 dark:border-slate-700">Batal</button>
                                            <button type="submit" className="flex-1 py-2 bg-blue-600 text-white rounded-xl text-xs font-bold hover:bg-blue-700">Simpan</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}

                        <main className="max-w-6xl mx-auto px-4 py-6">
                            {errorMsg && <div className="bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-4 rounded-xl mb-6 text-sm font-medium border border-red-100 dark:border-red-800 flex justify-between items-center shadow-sm">{errorMsg} <button onClick={() => setErrorMsg(null)}><Icon c="‚ùå" /></button></div>}

                            {/* === TAB GENERATOR === */}
                            {activeTab === 'generator' && (
                                <div className="grid lg:grid-cols-12 gap-8 animate-fade-in">
                                    <div className="lg:col-span-5 space-y-6">
                                        <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm sticky top-32">
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="font-bold flex items-center gap-2 text-lg"><Icon c="üéõÔ∏è" /> Input Konteks</h3>
                                                {savedPersonas.length > 0 && (
                                                    <div className="relative">
                                                        <button onClick={() => setShowPersonaMenu(!showPersonaMenu)} className="text-xs text-blue-600 font-bold hover:underline flex items-center gap-1 bg-blue-50 dark:bg-blue-900/20 px-3 py-1.5 rounded-lg border border-blue-100 dark:border-blue-800 transition-colors">Load Persona <Icon c={showPersonaMenu ? "üîº" : "üîΩ"} /></button>
                                                        {showPersonaMenu && (
                                                            <div className="absolute right-0 top-full mt-2 w-56 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl shadow-xl z-50 p-1 animate-fade-in">
                                                                <div className="max-h-64 overflow-y-auto custom-scrollbar">
                                                                    {savedPersonas.map(p => (
                                                                        <button key={p.id} onClick={() => handleUsePersona(p)} className="w-full text-left px-3 py-2.5 text-xs font-medium hover:bg-blue-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 rounded-lg">{p.name}</button>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                            
                                            {/* IMAGE UPLOAD (HIDDEN IF GEMMA/GROQ Text Models) */}
                                            {!aiModel.includes('gemma') && !aiModel.includes('llama') && !aiModel.includes('mixtral') && (
                                                <div onClick={() => fileInputRef.current?.click()} className="border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-xl p-4 text-center cursor-pointer hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/10 transition-all mb-5 relative overflow-hidden group bg-slate-50/50 dark:bg-slate-900/50">
                                                    {imagePreview ? <img src={imagePreview} className="h-32 w-full object-cover rounded-lg opacity-70 group-hover:opacity-100 transition-all" /> : <div className="py-2"><div className="text-2xl mb-2 opacity-50 grayscale">üñºÔ∏è</div><div className="text-slate-500 text-xs font-medium">Upload Gambar (Vision AI)</div></div>}
                                                </div>
                                            )}
                                            <input type="file" ref={fileInputRef} onChange={handleImageUpload} className="hidden" accept="image/*" />

                                            <div className="space-y-4">
                                                <div><label className="text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1 block">Topik</label><input value={formData.topic} name="topic" onChange={e=>setFormData({...formData, topic:e.target.value})} placeholder="Topik Utama" className="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-sm outline-none focus:ring-2 focus:ring-blue-500 font-medium transition-all" /></div>
                                                <div><label className="text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1 block">Keyword SEO</label><input value={formData.keyword} name="keyword" onChange={e=>setFormData({...formData, keyword:e.target.value})} placeholder="Kata kunci..." className="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all" /></div>
                                                <div><label className="text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1 block">Target Audiens</label><input value={formData.audience} name="audience" onChange={e=>setFormData({...formData, audience:e.target.value})} placeholder="Siapa targetnya?" className="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all" /></div>
                                                
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div><label className="text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1 block">Pain</label><input value={formData.pain} name="pain" onChange={e=>setFormData({...formData, pain:e.target.value})} placeholder="Masalah..." className="w-full px-3 py-2.5 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-sm outline-none" /></div>
                                                    <div><label className="text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1 block">Goal</label><input value={formData.goal} name="goal" onChange={e=>setFormData({...formData, goal:e.target.value})} placeholder="Impian..." className="w-full px-3 py-2.5 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-sm outline-none" /></div>
                                                </div>
                                                
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div><label className="text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1 block">Platform</label><select value={formData.platform} onChange={e=>setFormData({...formData, platform:e.target.value})} className="w-full px-3 py-2.5 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-sm outline-none"><option>TikTok / Reels</option><option>LinkedIn</option><option>Twitter</option><option>Instagram</option></select></div>
                                                    <div><label className="text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1 block">Vibe</label><select value={formData.vibe} onChange={e=>setFormData({...formData, vibe:e.target.value})} className="w-full px-3 py-2.5 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-sm outline-none"><option>Random</option><option>Santai</option><option>Netral</option><option>Profesional</option><option>Storytelling</option><option>Hard Selling</option><option>Kontroversial</option></select></div>
                                                </div>
                                            </div>
                                            
                                            <div className="grid grid-cols-4 gap-2 mt-6">
                                                <button onClick={generateWithAI} disabled={isGenerating || !formData.topic} className="col-span-3 bg-slate-900 dark:bg-blue-600 text-white py-3.5 rounded-xl font-bold hover:bg-slate-800 dark:hover:bg-blue-500 disabled:opacity-50 transition-all flex justify-center items-center gap-2 shadow-lg hover:shadow-xl hover:scale-[1.01]">
                                                    {isGenerating ? "..." : <><Icon c="‚ú®" /> Generate Hook</>}
                                                </button>
                                                <button onClick={() => setQuickSaveModal(true)} disabled={!formData.topic} className="col-span-1 bg-white border border-slate-200 dark:bg-slate-800 dark:border-slate-700 text-slate-600 dark:text-slate-300 rounded-xl font-bold text-xs flex flex-col items-center justify-center hover:bg-slate-50 dark:hover:bg-slate-700 transition-all" title="Simpan sebagai Persona">
                                                    <Icon c="üíæ" /> <span className="scale-90">Simpan</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="lg:col-span-7 space-y-6">
                                        <div className="flex justify-between items-center"><h3 className="font-bold text-lg">Hasil Generator <span className="bg-blue-100 text-blue-700 text-xs px-2 py-0.5 rounded-full ml-2">{generatedHooks.length}</span></h3>{generatedHooks.length > 0 && <button onClick={() => setGeneratedHooks([])} className="text-xs text-red-500 hover:text-red-600 font-bold px-3 py-1 bg-red-50 dark:bg-red-900/20 rounded-lg"><Icon c="üóëÔ∏è" /> Reset</button>}</div>
                                        {generatedHooks.length === 0 && !isGenerating ? <div className="flex flex-col items-center justify-center py-24 border-2 border-dashed border-slate-200 dark:border-slate-800 rounded-2xl text-slate-400 bg-slate-50/50 dark:bg-slate-900/50"><div className="bg-white dark:bg-slate-800 p-4 rounded-full shadow-sm mb-4 text-4xl opacity-50 grayscale">üß†</div><p className="font-medium">Siap membuat konten viral?</p></div> : <div className="space-y-5">{generatedHooks.map(hook => <HookCard key={hook.id} hook={hook} isSaved={savedHooks.some(h=>h.id===hook.id)} onSave={handleSaveHook} onAnalyze={()=>analyzeHook(hook.text)} onVisual={()=>generateVisual(hook.text)} onExpand={()=>generateContent(hook.text)} onCarousel={()=>generateContent(hook.text, true)} onRepurpose={()=>repurposeContent(hook.text)} />)}</div>}
                                    </div>
                                </div>
                            )}

                            {/* === TAB IDEA LAB === */}
                            {activeTab === 'ideas' && (
                                <div className="max-w-4xl mx-auto animate-fade-in">
                                    <div className="text-center mb-8"><h2 className="text-3xl font-bold mb-2">Idea Lab üí°</h2><p className="text-slate-500">Brainstorming ide konten tanpa batas.</p></div>
                                    <div className="flex flex-wrap justify-center gap-2 mb-8">{contentTypes.map(type => <button key={type} onClick={() => setIdeaType(type)} className={`px-4 py-2 rounded-full text-xs font-bold border ${ideaType === type ? 'bg-slate-900 dark:bg-white text-white dark:text-slate-900 transform scale-105' : 'bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 border-slate-200 dark:border-slate-700 hover:border-slate-400'}`}>{type}</button>)}</div>
                                    <div className="flex gap-2 bg-white dark:bg-slate-900 p-2 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-lg mb-8 max-w-2xl mx-auto"><input value={ideaInput} onChange={e=>setIdeaInput(e.target.value)} placeholder={`Niche: Bisnis Kopi, Parenting...`} className="flex-1 bg-transparent px-5 py-3 outline-none font-medium text-sm" onKeyDown={e => e.key === 'Enter' && generateIdeas()} /><button onClick={generateIdeas} disabled={isGeneratingIdeas} className="bg-slate-900 dark:bg-blue-600 text-white px-6 rounded-xl font-bold text-sm hover:opacity-90">{isGeneratingIdeas ? "..." : "Cari Ide"}</button></div>
                                    <div className="grid gap-4 max-w-2xl mx-auto">{generatedIdeas.map((idea, i) => <div key={i} className="bg-white dark:bg-slate-900 p-5 rounded-2xl border border-slate-200 dark:border-slate-800 hover:border-blue-400 cursor-pointer shadow-sm flex justify-between items-center" onClick={() => {setFormData({...formData, topic: idea.topic}); setActiveTab('generator');}}><div><div className="text-[10px] font-bold bg-slate-100 dark:bg-slate-800 inline-block px-2 py-1 rounded mb-2 text-slate-500">{ideaType}</div><h4 className="font-bold text-lg">{idea.topic}</h4><p className="text-slate-500 text-sm">{idea.angle}</p></div><button className="text-xs bg-blue-50 text-blue-600 px-3 py-1 rounded-full font-bold">Pakai ‚û°Ô∏è</button></div>)}</div>
                                </div>
                            )}

                            {/* === TAB PERSONA === */}
                            {activeTab === 'personas' && (
                                <div className="max-w-4xl mx-auto animate-fade-in">
                                    <div className="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                                        <h3 className="font-bold text-2xl flex items-center gap-2"><Icon c="üë•" /> Persona</h3>
                                        <div className="flex gap-2 w-full md:w-auto">
                                            <div className="relative flex-1 md:w-64"><span className="absolute left-3 top-2.5 text-slate-400 text-sm"><Icon c="üîç" /></span><input value={searchPersonas} onChange={e=>setSearchPersonas(e.target.value)} placeholder="Cari persona..." className="w-full pl-9 pr-4 py-2 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-sm outline-none" /></div>
                                            <button onClick={() => setPersonaModal({isOpen: true, isEditing: false})} className="bg-slate-900 dark:bg-blue-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-lg"><Icon c="‚ûï" /> Buat</button>
                                        </div>
                                    </div>
                                    <div className="grid md:grid-cols-2 gap-5">
                                        {filteredPersonas.map(p => (
                                            <div key={p.id} className="bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-slate-800 hover:shadow-lg transition-all relative group">
                                                <div className="flex justify-between items-start mb-4"><h4 className="font-bold text-lg">{p.name}</h4><span className="text-[10px] font-bold bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded uppercase">{p.platform}</span></div>
                                                <div className="space-y-2 mb-6 text-sm text-slate-600 dark:text-slate-300"><div className="flex gap-2"><span className="opacity-50">üéØ</span> {p.audience}</div><div className="flex gap-2"><span className="opacity-50">üò´</span> {p.pain}</div></div>
                                                <div className="flex gap-2 border-t border-slate-100 dark:border-slate-800 pt-4">
                                                    <button onClick={() => { handleUsePersona(p); setActiveTab('generator'); }} className="flex-1 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 py-2 rounded-lg text-xs font-bold hover:bg-blue-100">Pakai</button>
                                                    <button onClick={() => setSavedPersonas(prev => prev.filter(x => x.id !== p.id))} className="px-3 bg-red-50 text-red-500 rounded-lg hover:bg-red-100"><Icon c="üóëÔ∏è" /></button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* === TAB JADWAL === */}
                            {activeTab === 'calendar' && (
                                <div className="max-w-4xl mx-auto animate-fade-in">
                                    <div className="flex justify-between items-center mb-6">
                                        <h3 className="font-bold text-2xl flex items-center gap-2"><Icon c="üìÖ" /> Jadwal</h3>
                                        <div className="relative w-64"><span className="absolute left-3 top-2.5 text-slate-400 text-sm"><Icon c="üîç" /></span><input value={searchCalendar} onChange={e=>setSearchCalendar(e.target.value)} placeholder="Cari jadwal..." className="w-full pl-9 pr-4 py-2 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-sm outline-none" /></div>
                                    </div>
                                    <div className="space-y-4">
                                        {filteredCalendar.sort((a,b) => new Date(a.scheduledDate) - new Date(b.scheduledDate)).map(hook => (
                                            <div key={hook.id} className="bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800 flex gap-5 items-start shadow-sm hover:border-blue-400 transition-colors">
                                                <div className="bg-slate-100 dark:bg-slate-800 px-4 py-3 rounded-xl text-center min-w-[80px]"><div className="text-xs font-bold uppercase text-slate-500">{new Date(hook.scheduledDate).toLocaleString('id-ID', {month:'short'})}</div><div className="text-2xl font-black text-slate-800 dark:text-white">{new Date(hook.scheduledDate).getDate()}</div></div>
                                                <div className="flex-1"><div className="flex gap-2 mb-2"><span className="text-[10px] font-bold bg-blue-50 text-blue-600 px-2 py-0.5 rounded">{hook.category}</span><span className={`text-[10px] font-bold px-2 py-0.5 rounded ${hook.status === 'Sudah Tayang' ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600'}`}>{hook.status}</span></div><p className="font-medium text-slate-800 dark:text-slate-200 line-clamp-2">"{hook.text}"</p></div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* === TAB KOLEKSI === */}
                            {activeTab === 'saved' && (
                                <div className="animate-fade-in max-w-4xl mx-auto">
                                    <div className="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                                        <h3 className="font-bold text-2xl flex items-center gap-2"><Icon c="üìë" /> Koleksi</h3>
                                        <div className="relative w-full md:w-72"><span className="absolute left-3 top-2.5 text-slate-400 text-sm"><Icon c="üîç" /></span><input value={searchSaved} onChange={e=>setSearchSaved(e.target.value)} placeholder="Cari hook tersimpan..." className="w-full pl-9 pr-4 py-2 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-sm outline-none" /></div>
                                    </div>
                                    <div className="grid gap-5">
                                        {filteredSavedHooks.map(hook => (
                                            <HookCard key={hook.id} hook={hook} isSaved={true} onSave={handleSaveHook} showExtras={true} 
                                                onAnalyze={() => analyzeHook(hook.text)} onVisual={() => generateVisual(hook.text)}
                                                onExpand={() => generateContent(hook.text)} onCarousel={() => generateContent(hook.text, true)}
                                                onRepurpose={() => repurposeContent(hook.text)}
                                                onUpdateDate={(id, d) => setSavedHooks(prev => prev.map(h => h.id===id ? {...h, scheduledDate: d} : h))}
                                                onUpdateStatus={(id, s) => setSavedHooks(prev => prev.map(h => h.id===id ? {...h, status: s} : h))} />
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* === TAB FAQ === */}
                            {activeTab === 'faq' && (
                                <div className="max-w-3xl mx-auto animate-fade-in">
                                    <div className="text-center mb-10"><h2 className="text-3xl font-bold mb-2">Panduan & FAQ üìö</h2><p className="text-slate-500">Cari tahu cara memaksimalkan HookMaster.</p></div>
                                    <div className="relative mb-8"><span className="absolute left-4 top-3.5 text-slate-400"><Icon c="üîç" /></span><input value={searchFAQ} onChange={e=>setSearchFAQ(e.target.value)} placeholder="Cari panduan..." className="w-full pl-10 pr-4 py-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 shadow-sm outline-none focus:ring-2 focus:ring-blue-500" /></div>
                                    <div className="space-y-3">
                                        {filteredFAQ.map((item, idx) => (
                                            <div key={idx} className="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden">
                                                <button onClick={() => setOpenFaqIndex(openFaqIndex === idx ? null : idx)} className="w-full flex justify-between items-center p-5 text-left font-bold hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                                                    <span>{item.q}</span>
                                                    <span className={`transform transition-transform ${openFaqIndex === idx ? 'rotate-180' : ''}`}><Icon c="üîΩ" /></span>
                                                </button>
                                                <div className={`faq-content ${openFaqIndex === idx ? 'open' : ''} bg-slate-50 dark:bg-slate-950/30 px-5 pb-5`}>
                                                    <div className="pt-2 text-slate-600 dark:text-slate-400 text-sm leading-relaxed">{item.a}</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </main>

                        {/* === MODALS === */}
                        {/* 1. Create Persona Modal (Full) */}
                        {personaModal.isOpen && (
                            <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                                <div className="bg-white dark:bg-slate-900 w-full max-w-md p-6 rounded-2xl shadow-2xl animate-fade-in border border-slate-200 dark:border-slate-700">
                                    <h3 className="font-bold mb-4 text-lg">Buat Persona Baru</h3>
                                    <form onSubmit={(e) => {
                                        e.preventDefault();
                                        const data = Object.fromEntries(new FormData(e.target));
                                        setSavedPersonas(prev => [{...data, id: Date.now()}, ...prev]);
                                        setPersonaModal({isOpen: false});
                                    }} className="space-y-3">
                                        <input name="name" placeholder="Nama Persona (Cth: Ibu Muda)" className="w-full p-3 border rounded-xl dark:bg-slate-800 dark:border-slate-700 text-sm outline-none" required />
                                        <input name="audience" placeholder="Target Audiens" className="w-full p-3 border rounded-xl dark:bg-slate-800 dark:border-slate-700 text-sm outline-none" required />
                                        <input name="pain" placeholder="Pain Point Utama" className="w-full p-3 border rounded-xl dark:bg-slate-800 dark:border-slate-700 text-sm outline-none" required />
                                        <input name="goal" placeholder="Goal Utama" className="w-full p-3 border rounded-xl dark:bg-slate-800 dark:border-slate-700 text-sm outline-none" required />
                                        <input name="topic" placeholder="Topik Default" className="w-full p-3 border rounded-xl dark:bg-slate-800 dark:border-slate-700 text-sm outline-none" required />
                                        <div className="flex justify-end gap-2 mt-4 pt-4 border-t border-slate-100 dark:border-slate-800">
                                            <button type="button" onClick={() => setPersonaModal({isOpen:false})} className="px-4 py-2 text-slate-500 text-sm font-bold">Batal</button>
                                            <button type="submit" className="px-6 py-2 bg-slate-900 dark:bg-blue-600 text-white rounded-xl text-sm font-bold">Simpan</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}

                        {/* 2. Quick Save Persona Modal (From Home) */}
                        {quickSaveModal && (
                            <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                                <div className="bg-white dark:bg-slate-900 w-full max-w-sm p-6 rounded-2xl shadow-2xl animate-fade-in border border-slate-200 dark:border-slate-700 text-center">
                                    <div className="text-3xl mb-3">üíæ</div>
                                    <h3 className="font-bold mb-2">Simpan Persona Ini?</h3>
                                    <p className="text-xs text-slate-500 mb-4">Data yang sudah Anda ketik di Generator akan disimpan sebagai persona baru.</p>
                                    <form onSubmit={handleQuickSavePersona}>
                                        <input name="personaName" placeholder="Beri Nama (Cth: Klien Skincare)" className="w-full p-3 border rounded-xl dark:bg-slate-800 dark:border-slate-700 text-sm outline-none mb-4 text-center font-bold" autoFocus required />
                                        <div className="flex gap-2">
                                            <button type="button" onClick={() => setQuickSaveModal(false)} className="flex-1 py-2 text-slate-500 text-sm font-bold bg-slate-100 dark:bg-slate-800 rounded-xl">Batal</button>
                                            <button type="submit" className="flex-1 py-2 bg-blue-600 text-white rounded-xl text-sm font-bold">Simpan</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}

                        {/* Other Result Modals (Analysis, Visual, Content, Repurpose) */}
                        {analysisModal.isOpen && (
                            <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                                <div className="bg-white dark:bg-slate-900 w-full max-w-lg rounded-2xl shadow-2xl p-6 border border-slate-200 dark:border-slate-700">
                                    <div className="flex justify-between items-center mb-4"><h3 className="font-bold flex items-center gap-2"><Icon c="üìä" /> Viral Meter</h3><button onClick={()=>setAnalysisModal({...analysisModal, isOpen:false})} className="p-1 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full"><Icon c="‚ùå" /></button></div>
                                    {analysisModal.isLoading ? <div className="text-center py-10 animate-pulse text-slate-500">Menganalisis...</div> : (
                                        <div className="space-y-4 animate-fade-in">
                                            <div className="flex items-center gap-4 bg-slate-900 text-white p-4 rounded-xl shadow-md"><div className="text-4xl font-black">{analysisModal.data?.score}</div><div className="text-sm opacity-80">Viral Score</div></div>
                                            <div className="text-sm p-4 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 leading-relaxed">{analysisModal.data?.reason}</div>
                                            <div className="text-sm p-4 bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded-xl border border-blue-100 dark:border-blue-800/50 flex gap-2"><Icon c="üí°" /> <span>{analysisModal.data?.improvement}</span></div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                        {visualModal.isOpen && (
                            <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                                <div className="bg-white dark:bg-slate-900 w-full max-w-lg rounded-2xl shadow-2xl p-6 border border-slate-200 dark:border-slate-700">
                                    <div className="flex justify-between items-center mb-4"><h3 className="font-bold flex items-center gap-2"><Icon c="üé¨" /> Visual Director</h3><button onClick={()=>setVisualModal({...visualModal, isOpen:false})} className="p-1 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full"><Icon c="‚ùå" /></button></div>
                                    {visualModal.isLoading ? <div className="text-center py-10 animate-pulse text-slate-500">Merancang visual...</div> : (
                                        <div className="space-y-4 animate-fade-in">
                                            <div className="bg-slate-900 text-white p-6 rounded-xl text-center shadow-md relative overflow-hidden">
                                                <div className="absolute inset-0 bg-gradient-to-br from-blue-500/20 to-purple-500/20"></div>
                                                <div className="relative z-10"><div className="text-xs uppercase opacity-50 mb-2 tracking-widest">Overlay Text</div><div className="text-xl font-serif font-bold">"{visualModal.data?.overlay_text}"</div></div>
                                            </div>
                                            <div className="p-4 border rounded-xl dark:border-slate-700 bg-slate-50/50 dark:bg-slate-800/50"><div className="text-xs font-bold text-slate-400 uppercase mb-1 tracking-wider">Scene</div><div className="text-sm font-medium leading-relaxed">{visualModal.data?.scene}</div></div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                        {contentModal.isOpen && (
                            <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                                <div className="bg-white dark:bg-slate-900 w-full max-w-2xl rounded-2xl shadow-2xl p-6 flex flex-col max-h-[85vh] border border-slate-200 dark:border-slate-700">
                                    <div className="flex justify-between items-center mb-4"><h3 className="font-bold flex items-center gap-2"><Icon c="üìù" /> {contentModal.type}</h3><button onClick={()=>setContentModal({...contentModal, isOpen:false})} className="p-1 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full"><Icon c="‚ùå" /></button></div>
                                    <div className="overflow-y-auto custom-scrollbar flex-1 pr-2">
                                        {contentModal.isLoading ? <div className="text-center py-10 animate-pulse text-slate-500">Menulis...</div> : contentModal.data ? (
                                            <div className="space-y-4 animate-fade-in">
                                                {contentModal.data.map((row, i) => (
                                                    <div key={i} className="p-4 border rounded-xl dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                                                        <div className="text-xs font-bold text-blue-600 dark:text-blue-400 mb-1 uppercase tracking-wider">{row.section}</div>
                                                        <div className="text-sm mb-3 italic text-slate-500 dark:text-slate-400 flex items-center gap-1 bg-white dark:bg-slate-900 p-2 rounded-lg border border-slate-100 dark:border-slate-700"><Icon c="üëÅÔ∏è" /> Visual: {row.visual}</div>
                                                        <div className="text-sm whitespace-pre-line leading-relaxed font-medium">{row.content}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : <div className="whitespace-pre-line text-sm">{contentModal.text}</div>}
                                    </div>
                                    <button onClick={() => navigator.clipboard.writeText(contentModal.text)} className="mt-4 bg-slate-900 dark:bg-blue-600 text-white px-4 py-3 rounded-xl text-sm font-bold w-full hover:opacity-90 transition-opacity shadow-md flex items-center justify-center gap-2"><Icon c="üìã" /> Copy All Text</button>
                                </div>
                            </div>
                        )}
                        {repurposeModal.isOpen && (
                            <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                                <div className="bg-white dark:bg-slate-900 w-full max-w-2xl rounded-2xl shadow-2xl p-6 flex flex-col max-h-[85vh] border border-slate-200 dark:border-slate-700">
                                    <div className="flex justify-between items-center mb-4"><h3 className="font-bold flex items-center gap-2"><Icon c="üîÑ" /> Repurposing</h3><button onClick={()=>setRepurposeModal({...repurposeModal, isOpen:false})} className="p-1 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full"><Icon c="‚ùå" /></button></div>
                                    <div className="overflow-y-auto custom-scrollbar flex-1 space-y-6 pr-2">
                                        {repurposeModal.isLoading ? <div className="text-center py-10 animate-pulse text-slate-500">Mengubah format...</div> : repurposeModal.data && (
                                            <div className="animate-fade-in space-y-6">
                                                <div>
                                                    <div className="font-bold mb-2 flex items-center gap-2 text-slate-700 dark:text-slate-200"><Icon c="üéµ" /> TikTok Script</div>
                                                    <div className="text-sm p-4 bg-slate-50 dark:bg-slate-800 rounded-xl whitespace-pre-line border border-slate-200 dark:border-slate-700 leading-relaxed font-medium">{repurposeModal.data.tiktok_script}</div>
                                                </div>
                                                <div>
                                                    <div className="font-bold mb-2 flex items-center gap-2 text-slate-700 dark:text-slate-200"><Icon c="üíº" /> LinkedIn Post</div>
                                                    <div className="text-sm p-4 bg-slate-50 dark:bg-slate-800 rounded-xl whitespace-pre-line border border-slate-200 dark:border-slate-700 leading-relaxed font-medium">{repurposeModal.data.linkedin_post}</div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // --- HOOK CARD COMPONENT ---
        function HookCard({ hook, isSaved, onSave, showExtras, onUpdateDate, onUpdateStatus, onAnalyze, onVisual, onExpand, onCarousel, onRepurpose }) {
            const [copied, setCopied] = useState(false);
            const copy = () => { navigator.clipboard.writeText(hook.text); setCopied(true); setTimeout(()=>setCopied(false), 2000); };

            return (
                <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-slate-800 hover:shadow-lg hover:border-blue-300 dark:hover:border-blue-700 transition-all relative group">
                    <div className="flex justify-between items-start mb-3">
                        <div className="flex gap-2">
                            <span className="text-[10px] font-bold bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded uppercase tracking-wider text-slate-600 dark:text-slate-400">{hook.tone}</span>
                            <span className="text-[10px] font-bold text-slate-400 uppercase py-1">{hook.category}</span>
                        </div>
                        <button onClick={() => onSave(hook)} className={`p-1.5 rounded-full transition-all active:scale-90 ${isSaved ? 'text-red-500 bg-red-50 dark:bg-red-900/20' : 'text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-500'}`}><Icon c={isSaved ? "‚ù§Ô∏è" : "ü§ç"} /></button>
                    </div>
                    <p className="text-lg font-medium text-slate-800 dark:text-slate-100 mb-5 leading-relaxed">"{hook.text}"</p>
                    
                    <div className="flex flex-wrap gap-2 mb-4 pt-4 border-t border-slate-50 dark:border-slate-800">
                        <ActionButton onClick={onAnalyze} icon="üìä" label="Analisa" />
                        <ActionButton onClick={onVisual} icon="üé¨" label="Visual" />
                        <ActionButton onClick={onExpand} icon="üìù" label="Expand" />
                        <ActionButton onClick={onCarousel} icon="üéûÔ∏è" label="Carousel" />
                        <ActionButton onClick={onRepurpose} icon="üîÑ" label="Ubah" />
                    </div>

                    {showExtras && (
                        <div className="flex gap-2 mb-4 bg-slate-50 dark:bg-slate-800 p-2 rounded-lg items-center border border-slate-100 dark:border-slate-700">
                            <span className="opacity-70 ml-1"><Icon c="üìÖ" /></span>
                            <input type="date" value={hook.scheduledDate || ''} onChange={(e) => onUpdateDate(hook.id, e.target.value)} className="text-xs bg-transparent p-1 outline-none font-bold text-slate-600 dark:text-slate-300" />
                            <select value={hook.status || 'Ide'} onChange={(e) => onUpdateStatus(hook.id, e.target.value)} className="text-xs bg-transparent p-1 outline-none font-bold text-slate-600 dark:text-slate-300 border-l ml-2 pl-2 border-slate-300 dark:border-slate-600"><option>Ide</option><option>Scripting</option><option>Siap Post</option><option>Sudah Tayang</option></select>
                        </div>
                    )}
                    
                    <div className="flex justify-end">
                        <button onClick={copy} className={`flex items-center gap-1 px-4 py-2 rounded-xl text-xs font-bold transition-all shadow-sm active:scale-95 ${copied ? 'bg-green-500 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700'}`}>
                            {copied ? <Icon c="‚úÖ" /> : <Icon c="üìã" />} {copied ? 'Disalin' : 'Salin'}
                        </button>
                    </div>
                </div>
            )
        }

        function ActionButton({ onClick, icon, label }) {
            return (
                <button onClick={onClick} className="flex items-center gap-1 px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 hover: